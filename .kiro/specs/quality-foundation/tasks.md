# 実装計画

- [x] 1. テストフレームワークのセットアップ





  - Vitestとfast-checkをインストール
  - vitest.config.tsを作成し、テスト環境を設定
  - package.jsonにテストスクリプトを追加
  - テストセットアップファイル(src/test/setup.ts)を作成
  - _要件: 1.1, 1.2, 1.3, 1.4_

- [x] 2. calculateFireNumber関数のテスト実装





  - src/utils/calculations.test.tsファイルを作成
  - 正常系のユニットテストを実装（300万円の支出、4%の引き出し率 → 7500万円）
  - 境界値テスト（引き出し率0、負の値、支出0）を実装
  - _要件: 2.1, 2.2, 2.3, 2.4_

- [x] 2.1 calculateFireNumberのプロパティテスト実装


  - **プロパティ1: FIRE目標額の正値性**
  - **検証: 要件3.1**
  - src/utils/calculations.property.test.tsファイルを作成
  - fast-checkを使用して、正の年間支出と正の引き出し率に対して結果が常に正であることを検証
  - 最低100回の反復を設定

- [x] 2.2 calculateFireNumberのプロパティテスト実装


  - **プロパティ2: FIRE目標額と引き出し率の逆比例関係**
  - **検証: 要件3.2**
  - 引き出し率を2倍にすると結果が半分になることを検証

- [x] 2.3 calculateFireNumberのプロパティテスト実装


  - **プロパティ3: FIRE目標額と年間支出の比例関係**
  - **検証: 要件3.3**
  - 年間支出を2倍にすると結果も2倍になることを検証

- [x] 2.4 calculateFireNumberのプロパティテスト実装


  - **プロパティ4: FIRE目標額計算のラウンドトリップ**
  - **検証: 要件3.4**
  - FIRE目標額に(引き出し率 / 100)を掛けると元の年間支出と等しくなることを検証

- [-] 3. calculateYearsToFire関数のテスト実装



  - calculateYearsToFireの正常系ユニットテストを実装
  - 境界値テスト（資産が目標以上、貯蓄0、100年超過）を実装
  - _要件: 4.1, 4.2, 4.3, 4.4_


- [x] 3.1 calculateYearsToFireのプロパティテスト実装

  - **プロパティ5: 目標達成済みの場合の年数**
  - **検証: 要件5.1**
  - 現在資産がFIRE目標額以上の場合、結果が0であることを検証

- [x] 3.2 calculateYearsToFireのプロパティテスト実装


  - **プロパティ6: FIRE達成年数の非負性**
  - **検証: 要件5.2**
  - 正の年間貯蓄と非負の運用利回りに対して、結果が非負またはnullであることを検証

- [x] 3.3 calculateYearsToFireのプロパティテスト実装


  - **プロパティ7: 年間貯蓄増加による達成年数の単調性**
  - **検証: 要件5.3**
  - 年間貯蓄が増加すると達成年数が減少するか同じであることを検証

- [-] 3.4 calculateYearsToFireのプロパティテスト実装

  - **プロパティ8: 運用利回り増加による達成年数の単調性**
  - **検証: 要件5.4**
  - 運用利回りが増加すると達成年数が減少するか同じであることを検証

- [ ] 4. チェックポイント - すべてのテストが通ることを確認

  - すべてのテストが通ることを確認し、質問があればユーザーに尋ねる

- [ ] 5. simulateAssetGrowth関数のテスト実装

  - simulateAssetGrowthの正常系ユニットテストを実装
  - 退職前後のisRetiredフラグの検証
  - NISA使用時の税率適用の検証
  - 資産が0に達した場合の動作検証
  - _要件: 6.1, 6.2, 6.3, 6.4, 6.5_

- [ ] 5.1 simulateAssetGrowthのプロパティテスト実装

  - **プロパティ9: シミュレーションデータポイント数の不変性**
  - **検証: 要件7.1**
  - データポイント数が(100 - 現在年齢 + 1)と等しいことを検証

- [ ] 5.2 simulateAssetGrowthのプロパティテスト実装
  - **プロパティ10: 支出超過時の資産減少**
  - **検証: 要件7.2**
  - すべての年で支出が収入を超える場合、資産が単調減少するか0に留まることを検証

- [ ] 5.3 simulateAssetGrowthのプロパティテスト実装
  - **プロパティ11: 収入超過時の資産増加**
  - **検証: 要件7.3**
  - すべての年で収入が支出を超え運用利回りが正の場合、資産が単調増加することを検証

- [ ] 5.4 simulateAssetGrowthのプロパティテスト実装
  - **プロパティ12: インフレ率0時の支出一定性**
  - **検証: 要件7.4**
  - インフレ率が0の場合、すべての年で支出が一定であることを検証

- [ ] 6. calculateMonteCarlo関数のテスト実装
  - calculateMonteCarloの正常系ユニットテストを実装
  - パーセンタイルの順序関係の検証
  - ボラティリティ0時の収束の検証
  - _要件: 8.1, 8.2, 8.3, 8.4_

- [ ] 6.1 calculateMonteCarloのプロパティテスト実装
  - **プロパティ13: モンテカルロパーセンタイルの順序性**
  - **検証: 要件9.1**
  - percentile10が常にpercentile90以下であることを検証

- [ ] 6.2 calculateMonteCarloのプロパティテスト実装
  - **プロパティ14: ボラティリティ増加による分散拡大**
  - **検証: 要件9.2**
  - ボラティリティが増加するとpercentile10とpercentile90の差が増加することを検証

- [ ] 7. チェックポイント - すべてのテストが通ることを確認
  - すべてのテストが通ることを確認し、質問があればユーザーに尋ねる

- [ ] 8. 入力検証モジュールの実装
  - src/utils/validation.tsファイルを作成
  - validateAge関数を実装（数値チェック、範囲チェック）
  - validateRetirementAge関数を実装（現在年齢との比較）
  - validateAmount関数を実装（数値チェック、非負チェック、上限チェック）
  - validatePercentage関数を実装（数値チェック、範囲チェック）
  - validateFireInputs関数を実装（すべての入力を検証）
  - _要件: 10.1, 10.2, 10.3, 10.4_

- [ ] 8.1 入力検証モジュールのユニットテスト実装
  - src/utils/validation.test.tsファイルを作成
  - 各検証関数の正常系とエラー系のテストを実装
  - エラーメッセージの内容を検証
  - _要件: 10.1, 10.2, 10.3, 10.4_

- [ ] 9. LocalStorageフックの実装
  - src/hooks/useLocalStorage.tsファイルを作成
  - useLocalStorageフックを実装
  - localStorage読み取りエラーのハンドリング
  - localStorage書き込みエラーのハンドリング
  - エラー状態の管理
  - _要件: 11.1, 11.2, 11.3, 11.4_

- [ ] 9.1 LocalStorageフックのユニットテスト実装
  - src/hooks/useLocalStorage.test.tsファイルを作成
  - 正常系のテスト（読み取り、書き込み）
  - エラー系のテスト（localStorage利用不可、破損データ、クォータ超過）
  - _要件: 11.1, 11.2, 11.3, 11.4_

- [ ] 10. Dashboardコンポーネントへのエラーハンドリング追加
  - useLocalStorageフックを使用するようにDashboardを更新
  - 入力検証をhandleInputChangeに統合
  - 検証エラー状態の管理
  - エラーメッセージの表示UI追加
  - _要件: 12.1, 12.2, 12.3, 12.4_

- [ ] 10.1 Dashboardコンポーネントのエラーハンドリングテスト
  - エラー表示のテスト
  - エラー回復のテスト
  - _要件: 12.1, 12.2, 12.3, 12.4_

- [ ] 11. 最終チェックポイント - すべてのテストが通ることを確認
  - すべてのテストが通ることを確認し、質問があればユーザーに尋ねる
